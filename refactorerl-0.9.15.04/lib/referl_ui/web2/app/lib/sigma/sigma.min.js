var sigma={};sigma.tools={};sigma.classes={};sigma.instances={};(function(){if(!Array.prototype.some){Array.prototype.some=function(e){var t=this.length;if(typeof e!="function"){throw new TypeError}var n=arguments[1];for(var r=0;r<t;r++){if(r in this&&e.call(n,this[r],r,this)){return true}}return false}}if(!Array.prototype.forEach){Array.prototype.forEach=function(e){var t=this.length;if(typeof e!="function"){throw new TypeError}var n=arguments[1];for(var r=0;r<t;r++){if(r in this){e.call(n,this[r],r,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(e){var t=this.length;if(typeof e!="function"){throw new TypeError}var n=new Array(t);var r=arguments[1];for(var i=0;i<t;i++){if(i in this){n[i]=e.call(r,this[i],i,this)}}return n}}if(!Array.prototype.filter){Array.prototype.filter=function(e){var t=this.length;if(typeof e!="function")throw new TypeError;var n=new Array;var r=arguments[1];for(var i=0;i<t;i++){if(i in this){var s=this[i];if(e.call(r,s,i,this)){n.push(s)}}}return n}}if(!Object.keys){Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(i){if(typeof i!=="object"&&typeof i!=="function"||i===null){throw new TypeError("Object.keys called on non-object")}var s=[];for(var o in i){if(e.call(i,o))s.push(o)}if(t){for(var u=0;u<r;u++){if(e.call(i,n[u])){s.push(n[u])}}}return s}}()}})();sigma.classes.Cascade=function(){this.p={};this.config=function(e,t){if(typeof e=="string"&&t==undefined){return this.p[e]}else{var n=typeof e=="object"&&t==undefined?e:{};if(typeof e=="string"){n[e]=t}for(var r in n){if(this.p[r]!=undefined){this.p[r]=n[r]}}return this}}};sigma.classes.EventDispatcher=function(){function n(n,r){if(!r||!n){return t}var i=typeof n=="string"?n.split(" "):n;i.forEach(function(t){if(!e[t]){e[t]=[]}e[t].push({h:r,one:true})});return t}function r(n,r){if(!r||!n){return t}var i=typeof n=="string"?n.split(" "):n;i.forEach(function(t){if(!e[t]){e[t]=[]}e[t].push({h:r,one:false})});return t}function i(n,r){if(!n){e={}}var i=typeof n=="string"?n.split(" "):n;if(r){i.forEach(function(t){if(e[t]){e[t]=e[t].filter(function(e){return e["h"]!=r})}if(e[t]&&e[t].length==0){delete e[t]}})}else{i.forEach(function(t){delete e[t]})}return t}function s(n,r){if(e[n]){e[n].forEach(function(e){e["h"]({type:n,content:r,target:t})});e[n]=e[n].filter(function(e){return!e["one"]})}return t}var e={};var t=this;this.one=n;this.bind=r;this.unbind=i;this.dispatch=s};(function(){function r(){function t(t,n){if(e.nodesIndex[t]){throw new Error('Node "'+t+'" already exists.')}n=n||{};var r={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:false,active:false,hidden:false,forceLabel:false,label:t.toString(),id:t.toString(),attr:{}};for(var i in n){switch(i){case"id":break;case"x":case"y":case"size":r[i]=+n[i];break;case"fixed":case"active":case"hidden":case"forceLabel":r[i]=!!n[i];break;case"color":case"label":r[i]=n[i];break;default:r["attr"][i]=n[i]}}e.nodes.push(r);e.nodesIndex[t.toString()]=r;return e}function n(e){return{x:e["x"],y:e["y"],size:e["size"],degree:e["degree"],inDegree:e["inDegree"],outDegree:e["outDegree"],displayX:e["displayX"],displayY:e["displayY"],displaySize:e["displaySize"],label:e["label"],id:e["id"],color:e["color"],fixed:e["fixed"],active:e["active"],hidden:e["hidden"],forceLabel:e["forceLabel"],attr:e["attr"]}}function r(t,n){for(var r in n){switch(r){case"id":case"attr":case"degree":case"inDegree":case"outDegree":case"displayX":case"displayY":case"displaySize":break;case"x":case"y":case"size":t[r]=+n[r];break;case"fixed":case"active":case"hidden":case"forceLabel":t[r]=!!n[r];break;case"color":case"label":t[r]=(n[r]||"").toString();break;default:t["attr"][r]=n[r]}}return e}function i(t){var n=(t instanceof Array?t:[t])||[];var r={};n.forEach(function(t){if(e.nodesIndex[t]){r[t]=true}else{sigma.log('Node "'+t+'" does not exist.')}});var i=[];e.nodes.forEach(function(e,t){if(e["id"]in r){i.unshift(t);if(e["degree"]==0){delete r[e["id"]]}}});i.forEach(function(t){e.nodes.splice(t,1)});e.edges=e.edges.filter(function(t){if(t["source"]["id"]in r){delete e.edgesIndex[t["id"]];t["target"]["degree"]--;t["target"]["inDegree"]--;return false}else if(t["target"]["id"]in r){delete e.edgesIndex[t["id"]];t["source"]["degree"]--;t["source"]["outDegree"]--;return false}return true});return e}function s(t,n,r,i){if(e.edgesIndex[t]){throw new Error('Edge "'+t+'" already exists.')}if(!e.nodesIndex[n]){var s="Edge's source \""+n+'" does not exist yet.';throw new Error(s)}if(!e.nodesIndex[r]){var s="Edge's target \""+r+'" does not exist yet.';throw new Error(s)}i=i||{};var o={source:e.nodesIndex[n],target:e.nodesIndex[r],size:1,weight:1,displaySize:.5,label:t.toString(),id:t.toString(),hidden:false,attr:{}};o["source"]["degree"]++;o["source"]["outDegree"]++;o["target"]["degree"]++;o["target"]["inDegree"]++;for(var u in i){switch(u){case"id":case"source":case"target":break;case"hidden":o[u]=!!i[u];break;case"size":case"weight":o[u]=+i[u];break;case"color":case"arrow":case"type":o[u]=i[u].toString();break;case"label":o[u]=i[u];break;default:o["attr"][u]=i[u]}}e.edges.push(o);e.edgesIndex[t.toString()]=o;return e}function o(e){return{source:e["source"]["id"],target:e["target"]["id"],size:e["size"],type:e["type"],arrow:e["arrow"],weight:e["weight"],displaySize:e["displaySize"],label:e["label"],hidden:e["hidden"],id:e["id"],attr:e["attr"],color:e["color"]}}function u(t,n){for(var r in n){switch(r){case"id":case"displaySize":break;case"weight":case"size":t[r]=+n[r];break;case"source":case"target":t[r]=e.nodesIndex[r]||t[r];break;case"hidden":t[r]=!!n[r];break;case"color":case"label":case"arrow":case"type":t[r]=(n[r]||"").toString();break;default:t["attr"][r]=n[r]}}return e}function a(t){var n=(t instanceof Array?t:[t])||[];n.forEach(function(t){if(e.edgesIndex[t]){e.edgesIndex[t]["source"]["degree"]--;e.edgesIndex[t]["source"]["outDegree"]--;e.edgesIndex[t]["target"]["degree"]--;e.edgesIndex[t]["target"]["inDegree"]--;var n=null;e.edges.some(function(e,r){if(e["id"]==t){n=r;return true}return false});n!=null&&e.edges.splice(n,1);delete e.edgesIndex[t]}else{sigma.log('Edge "'+t+'" does not exist.')}});return e}function f(){e.nodes=[];e.nodesIndex={};e.edges=[];e.edgesIndex={};return e}function l(t,n,r,i){var s=0,o=0;r&&e.nodes.forEach(function(e){o=Math.max(e["size"],o)});i&&e.edges.forEach(function(e){s=Math.max(e["size"],s)});o=o||1;s=s||1;var u,a,f,l;r&&e.nodes.forEach(function(e){a=Math.max(e["x"],a||e["x"]);u=Math.min(e["x"],u||e["x"]);l=Math.max(e["y"],l||e["y"]);f=Math.min(e["y"],f||e["y"])});var c=e.p.scalingMode=="outside"?Math.max(t/Math.max(a-u,1),n/Math.max(l-f,1)):Math.min(t/Math.max(a-u,1),n/Math.max(l-f,1));var h=(e.p.maxNodeSize||o)/c;a+=h;u-=h;l+=h;f-=h;c=e.p.scalingMode=="outside"?Math.max(t/Math.max(a-u,1),n/Math.max(l-f,1)):Math.min(t/Math.max(a-u,1),n/Math.max(l-f,1));var p,d;if(!e.p.maxNodeSize&&!e.p.minNodeSize){p=1;d=0}else if(e.p.maxNodeSize==e.p.minNodeSize){p=0;d=e.p.maxNodeSize}else{p=(e.p.maxNodeSize-e.p.minNodeSize)/o;d=e.p.minNodeSize}var v,m;if(!e.p.maxEdgeSize&&!e.p.minEdgeSize){v=1;m=0}else if(e.p.maxEdgeSize==e.p.minEdgeSize){v=0;m=e.p.minEdgeSize}else{v=(e.p.maxEdgeSize-e.p.minEdgeSize)/s;m=e.p.minEdgeSize}r&&e.nodes.forEach(function(e){e["displaySize"]=e["size"]*p+d;if(!e["fixed"]){e["displayX"]=(e["x"]-(a+u)/2)*c+t/2;e["displayY"]=(e["y"]-(l+f)/2)*c+n/2}});i&&e.edges.forEach(function(e){e["displaySize"]=e["size"]*v+m});return e}function c(t,n,r,i,s){var o=Math.pow(r,e.p.nodesPowRatio);i&&e.nodes.forEach(function(e){if(!e["fixed"]){e["displayX"]=e["displayX"]*r+t;e["displayY"]=e["displayY"]*r+n}e["displaySize"]=e["displaySize"]*o});s&&e.edges.forEach(function(t){t["displaySize"]=t["displaySize"]*Math.pow(r,e.p.edgesPowRatio);t["arrowDisplaySize"]=t["displaySize"]*3*o});return e}function h(){e.borders={};e.nodes.forEach(function(t){e.borders.minX=Math.min(e.borders.minX==undefined?t["displayX"]-t["displaySize"]:e.borders.minX,t["displayX"]-t["displaySize"]);e.borders.maxX=Math.max(e.borders.maxX==undefined?t["displayX"]+t["displaySize"]:e.borders.maxX,t["displayX"]+t["displaySize"]);e.borders.minY=Math.min(e.borders.minY==undefined?t["displayY"]-t["displaySize"]:e.borders.minY,t["displayY"]-t["displaySize"]);e.borders.maxY=Math.max(e.borders.maxY==undefined?t["displayY"]-t["displaySize"]:e.borders.maxY,t["displayY"]-t["displaySize"])})}function p(t,n){var r,i,s,o=[],u=[];e.nodes.forEach(function(e){if(e["hidden"]){e["hover"]=false;return}r=Math.abs(e["displayX"]-t);i=Math.abs(e["displayY"]-n);s=e["displaySize"];var a=e["hover"];var f=r<s&&i<s&&Math.sqrt(r*r+i*i)<s;if(a&&!f){e["hover"]=false;u.push(e.id)}else if(f&&!a){e["hover"]=true;o.push(e.id)}});o.length&&e.dispatch("overnodes",o);u.length&&e.dispatch("outnodes",u);return e}function d(t,i){var s=i?i.map(function(t){return e.nodesIndex[t]}):e.nodes;var o=s.map(n);o.forEach(t);s.forEach(function(e,t){r(e,o[t])});return e}function v(t,n){var r=n?n.map(function(t){return e.edgesIndex[t]}):e.edges;var i=r.map(o);i.forEach(t);r.forEach(function(e,t){u(e,i[t])});return e}function m(t){var r=((t instanceof Array?t:[t])||[]).map(function(t){return n(e.nodesIndex[t])});return t instanceof Array?r:r[0]}function g(t){var n=((t instanceof Array?t:[t])||[]).map(function(t){return o(e.edgesIndex[t])});return t instanceof Array?n:n[0]}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var e=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",nodesPowRatio:.5,edgesPowRatio:0};this.borders={};f();this.addNode=t;this.addEdge=s;this.dropNode=i;this.dropEdge=a;this.iterEdges=v;this.iterNodes=d;this.getEdges=g;this.getNodes=m;this.empty=f;this.rescale=l;this.translate=c;this.setBorders=h;this.checkHover=p}function i(e,t){function r(){if(!n.monitoring){n.monitoring=window.setInterval(s,1e3/n.p.fps)}return n}function i(){if(n.monitoring){window.clearInterval(n.monitoring);n.monitoring=null;n.p.dom.innerHTML=""}return n}function s(){var e="";e+="<p>GLOBAL :</p>";for(var t in n.p.globalProbes){e+="<p>"+t+" : "+n.p.globalProbes[t]()+"</p>"}e+="<br><p>LOCAL :</p>";for(var t in n.p.localProbes){e+="<p>"+t+" : "+n.p.localProbes[t]()+"</p>"}n.p.dom.innerHTML=e;return n}sigma.classes.Cascade.call(this);var n=this;this.instance=e;this.monitoring=false;this.p={fps:40,dom:t,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return n.instance.graph.nodes.length},"Edges count":function(){return n.instance.graph.edges.length}}};this.activate=r;this.desactivate=i}function s(e){function y(e){return e.offsetX!=undefined&&e.offsetX||e.layerX!=undefined&&e.layerX||e.clientX!=undefined&&e.clientX}function b(e){return e.offsetY!=undefined&&e.offsetY||e.layerY!=undefined&&e.layerY||e.clientY!=undefined&&e.clientY}function w(e){return e.wheelDelta!=undefined&&e.wheelDelta||e.detail!=undefined&&-e.detail}function E(e){n=t.mouseX;r=t.mouseY;t.mouseX=y(e);t.mouseY=b(e);t.isMouseDown&&k(e);t.dispatch("move");if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}function S(e){if(t.p.mouseEnabled&&t.isMouseDown){t.isMouseDown=false;t.dispatch("mouseup");C();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}}function x(e){if(t.p.mouseEnabled){t.isMouseDown=true;n=t.mouseX;r=t.mouseY;t.dispatch("mousedown");N();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}}function T(e){if(t.p.mouseEnabled){L(t.mouseX,t.mouseY,t.ratio*(w(e)>0?t.p.zoomMultiply:1/t.p.zoomMultiply));if(t.p["blockScroll"]){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}}}function N(){o=t.stageX;u=t.stageY;i=t.mouseX;s=t.mouseY;h=t.stageX;p=t.stageX;d=t.stageY;v=t.stageY;t.dispatch("startdrag")}function C(){if(o!=t.stageX||u!=t.stageY){L(t.stageX+t.p.inertia*(t.stageX-p),t.stageY+t.p.inertia*(t.stageY-v))}}function k(){var e=t.mouseX-i+o;var n=t.mouseY-s+u;if(e!=t.stageX||n!=t.stageY){p=h;v=d;h=e;d=n;t.stageX=e;t.stageY=n;t.dispatch("drag")}}function L(e,n,r){if(t.isMouseDown){return}window.clearInterval(t.interpolationID);g=r!=undefined;o=t.stageX;l=e;u=t.stageY;c=n;a=t.ratio;f=r||t.ratio;f=Math.min(Math.max(f,t.p.minRatio),t.p.maxRatio);m=t.p.directZooming?1-(g?t.p.zoomDelta:t.p.dragDelta):0;if(t.ratio!=f||t.stageX!=l||t.stageY!=c){O();t.interpolationID=window.setInterval(O,50);t.dispatch("startinterpolate")}}function A(){var e=t.ratio;if(g){t.ratio=f;t.stageX=l+(t.stageX-l)*t.ratio/e;t.stageY=c+(t.stageY-c)*t.ratio/e}else{t.stageX=l;t.stageY=c}t.dispatch("stopinterpolate")}function O(){m+=g?t.p.zoomDelta:t.p.dragDelta;m=Math.min(m,1);var e=sigma.easing.quadratic.easeout(m);var n=t.ratio;t.ratio=n*(1-e)+f*e;if(g){t.stageX=l+(t.stageX-l)*t.ratio/n;t.stageY=c+(t.stageY-c)*t.ratio/n}else{t.stageX=o*(1-e)+l*e;t.stageY=u*(1-e)+c*e}t.dispatch("interpolate");if(m>=1){window.clearInterval(t.interpolationID);A()}}function M(e,n,r){return t}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var t=this;var e=e;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:.1,dragDelta:.3,zoomMultiply:2,directZooming:false,blockScroll:true,inertia:1.1,mouseEnabled:true};var n=0;var r=0;var i=0;var s=0;var o=0;var u=0;var a=1;var f=1;var l=0;var c=0;var h=0;var p=0;var d=0;var v=0;var m=0;var g=false;this.stageX=0;this.stageY=0;this.ratio=1;this.mouseX=0;this.mouseY=0;this.isMouseDown=false;e.addEventListener("DOMMouseScroll",T,true);e.addEventListener("mousewheel",T,true);e.addEventListener("mousemove",E,true);e.addEventListener("mousedown",x,true);document.addEventListener("mouseup",S,true);this.checkBorders=M;this.interpolate=L}function o(t,n,r,i,s,o,u){function c(){var t=s.edges.length;var n,r,i=0;while(i++<a.p.edgesSpeed&&a.currentEdgeIndex<t){e=s.edges[a.currentEdgeIndex];n=e["source"];r=e["target"];if(e["hidden"]||n["hidden"]||r["hidden"]||!a.isOnScreen(n)&&!a.isOnScreen(r)){a.currentEdgeIndex++}else{v(s.edges[a.currentEdgeIndex++])}}return a.currentEdgeIndex<t}function h(){var e=s.nodes.length;var t=0;while(t++<a.p.nodesSpeed&&a.currentNodeIndex<e){if(!a.isOnScreen(s.nodes[a.currentNodeIndex])){a.currentNodeIndex++}else{d(s.nodes[a.currentNodeIndex++])}}return a.currentNodeIndex<e}function p(){var e=s.nodes.length;var t=0;while(t++<a.p.labelsSpeed&&a.currentLabelIndex<e){if(!a.isOnScreen(s.nodes[a.currentLabelIndex])){a.currentLabelIndex++}else{m(s.nodes[a.currentLabelIndex++])}}return a.currentLabelIndex<e}function d(e){var n=Math.round(e["displaySize"]*10)/10;var r=t;r.fillStyle=e["color"];r.beginPath();r.arc(e["displayX"],e["displayY"],n,0,Math.PI*2,true);r.closePath();r.fill();e["hover"]&&g(e);return a}function v(e){var t=[e["source"]["displayX"],e["source"]["displayY"]];var r=[e["target"]["displayX"],e["target"]["displayY"]];var i=e["color"];if(!i){switch(a.p.edgeColor){case"source":i=e["source"]["color"]||a.p.defaultNodeColor;break;case"target":i=e["target"]["color"]||a.p.defaultNodeColor;break;default:i=a.p.defaultEdgeColor;break}}var s=n;switch(e["type"]||a.p.defaultEdgeType){case"curve":s.strokeStyle=i;var o=(t[0]+r[0])/2+(r[1]-t[1])/4;var u=(t[1]+r[1])/2+(t[0]-r[0])/4;if(E("source",e["arrow"])){t=S(s,t,e["source"]["displaySize"],o,u,e["arrowDisplaySize"])}if(E("target",e["arrow"])){r=S(s,r,e["target"]["displaySize"],o,u,e["arrowDisplaySize"])}s.lineWidth=e["displaySize"]/3;s.beginPath();s.moveTo(t[0],t[1]);s.quadraticCurveTo(o,u,r[0],r[1]);s.stroke();break;case"line":default:s.strokeStyle=i;if(E("source",e["arrow"])){t=S(s,t,e["source"]["displaySize"],r[0],r[1],e["arrowDisplaySize"])}if(E("target",e["arrow"])){r=S(s,r,e["target"]["displaySize"],t[0],t[1],e["arrowDisplaySize"])}s.lineWidth=e["displaySize"]/3;s.beginPath();s.moveTo(t[0],t[1]);s.lineTo(r[0],r[1]);s.stroke();break}return a}function m(e){var t=r;if(e["displaySize"]>=a.p.labelThreshold||e["forceLabel"]){var n=a.p.labelSize=="fixed"?a.p.defaultLabelSize:a.p.labelSizeRatio*e["displaySize"];t.font=a.p.fontStyle+n+"px "+a.p.font;t.fillStyle=a.p.labelColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultLabelColor;t.fillText(e["label"],Math.round(e["displayX"]+e["displaySize"]*1.5),Math.round(e["displayY"]+n/2-3))}return a}function g(e){var t=i;var n=a.p.labelSize=="fixed"?a.p.defaultLabelSize:a.p.labelSizeRatio*e["displaySize"];t.font=(a.p.hoverFontStyle||a.p.fontStyle||"")+" "+n+"px "+(a.p.hoverFont||a.p.font||"");t.fillStyle=a.p.labelHoverBGColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultHoverLabelBGColor;t.beginPath();if(a.p.labelHoverShadow){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=4;t.shadowColor=a.p.labelHoverShadowColor}sigma.tools.drawRoundRect(t,Math.round(e["displayX"]-n/2-2),Math.round(e["displayY"]-n/2-2),Math.round(t.measureText(e["label"]).width+e["displaySize"]*1.5+n/2+4),Math.round(n+4),Math.round(n/2+2),"left");t.closePath();t.fill();t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.beginPath();t.fillStyle=a.p.nodeBorderColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultNodeBorderColor;t.arc(Math.round(e["displayX"]),Math.round(e["displayY"]),e["displaySize"]+a.p.borderSize,0,Math.PI*2,true);t.closePath();t.fill();t.beginPath();t.fillStyle=a.p.nodeHoverColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultNodeHoverColor;t.arc(Math.round(e["displayX"]),Math.round(e["displayY"]),e["displaySize"],0,Math.PI*2,true);t.closePath();t.fill();t.fillStyle=a.p.labelHoverColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultLabelHoverColor;t.fillText(e["label"],Math.round(e["displayX"]+e["displaySize"]*1.5),Math.round(e["displayY"]+n/2-3));return a}function y(e){var t=i;if(!b(e)){return a}var n=a.p.labelSize=="fixed"?a.p.defaultLabelSize:a.p.labelSizeRatio*e["displaySize"];t.font=(a.p.activeFontStyle||a.p.fontStyle||"")+" "+n+"px "+(a.p.activeFont||a.p.font||"");t.fillStyle=a.p.labelHoverBGColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultActiveLabelBGColor;t.beginPath();if(a.p.labelActiveShadow){t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=4;t.shadowColor=a.p.labelActiveShadowColor}sigma.tools.drawRoundRect(t,Math.round(e["displayX"]-n/2-2),Math.round(e["displayY"]-n/2-2),Math.round(t.measureText(e["label"]).width+e["displaySize"]*1.5+n/2+4),Math.round(n+4),Math.round(n/2+2),"left");t.closePath();t.fill();t.shadowOffsetX=0;t.shadowOffsetY=0;t.shadowBlur=0;t.beginPath();t.fillStyle=a.p.nodeBorderColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultNodeBorderColor;t.arc(Math.round(e["displayX"]),Math.round(e["displayY"]),e["displaySize"]+a.p.borderSize,0,Math.PI*2,true);t.closePath();t.fill();t.beginPath();t.fillStyle=a.p.nodeActiveColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultNodeActiveColor;t.arc(Math.round(e["displayX"]),Math.round(e["displayY"]),e["displaySize"],0,Math.PI*2,true);t.closePath();t.fill();t.fillStyle=a.p.labelActiveColor=="node"?e["color"]||a.p.defaultNodeColor:a.p.defaultLabelActiveColor;t.fillText(e["label"],Math.round(e["displayX"]+e["displaySize"]*1.5),Math.round(e["displayY"]+n/2-3));return a}function b(e){if(isNaN(e["x"])||isNaN(e["y"])){throw new Error("A node's coordinate is not a "+"number (id: "+e["id"]+")")}return!e["hidden"]&&e["displayX"]+e["displaySize"]>-f/3&&e["displayX"]-e["displaySize"]<f*4/3&&e["displayY"]+e["displaySize"]>-l/3&&e["displayY"]-e["displaySize"]<l*4/3}function w(e,t){f=e;l=t;return a}function E(e,t){return t==e||t=="both"||!t&&(a.p.defaultEdgeArrow==e||a.p.defaultEdgeArrow=="both")}function S(e,t,n,r,i,s){var o=t[0]-r;var u=t[1]-i;var a=n/Math.sqrt(o*o+u*u);t[0]=t[0]-o*a;t[1]=t[1]-u*a;e.lineWidth=0;e.fillStyle=e.strokeStyle;sigma.tools.drawArrowhead(e,t[0],t[1],s,sigma.tools.getIncidenceAngle(r,i,t[0],t[1]));return t}sigma.classes.Cascade.call(this);var a=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:true,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:true,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",defaultEdgeArrow:"none",defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200};var t=t;var n=n;var r=r;var i=i;var s=s;var f=o;var l=u;this.currentEdgeIndex=0;this.currentNodeIndex=0;this.currentLabelIndex=0;this.task_drawLabel=p;this.task_drawEdge=c;this.task_drawNode=h;this.drawActiveNode=y;this.drawHoverNode=g;this.isOnScreen=b;this.resize=w}function u(e,t){function a(e,t){var n=u.width,r=u.height;if(e!=undefined&&t!=undefined){u.width=e;u.height=t}else{u.width=u.domRoot.offsetWidth;u.height=u.domRoot.offsetHeight}if(n!=u.width||r!=u.height){for(var i in u.domElements){u.domElements[i].setAttribute("width",u.width+"px");u.domElements[i].setAttribute("height",u.height+"px")}u.plotter.resize(u.width,u.height);u.draw(u.p.lastNodes,u.p.lastEdges,u.p.lastLabels,true)}return u}function f(){sigma.chronos.removeTask("node_"+u.id,2).removeTask("edge_"+u.id,2).removeTask("label_"+u.id,2).stopTasks();return u}function l(e,t){u.domElements[e]=document.createElement(t);u.domElements[e].style.position="absolute";u.domElements[e].setAttribute("id","sigma_"+e+"_"+u.id);u.domElements[e].setAttribute("class","sigma_"+e+"_"+t);u.domElements[e].setAttribute("width",u.width+"px");u.domElements[e].setAttribute("height",u.height+"px");u.domRoot.appendChild(u.domElements[e]);return u}function c(e,t,n,r){if(r&&sigma.chronos.getGeneratorsIDs().some(function(e){return!!e.match(new RegExp("_ext_"+u.id+"$",""))})){return u}var i=e==undefined?u.p.drawNodes:e;var s=t==undefined?u.p.drawEdges:t;var o=n==undefined?u.p.drawLabels:n;var a={nodes:i,edges:s,labels:o};u.p.lastNodes=i;u.p.lastEdges=s;u.p.lastLabels=o;f();u.graph.rescale(u.width,u.height,i>0,s>0).setBorders();u.mousecaptor.checkBorders(u.graph.borders,u.width,u.height);u.graph.translate(u.mousecaptor.stageX,u.mousecaptor.stageY,u.mousecaptor.ratio,i>0,s>0);u.dispatch("graphscaled");for(var l in u.domElements){if(u.domElements[l].nodeName.toLowerCase()=="canvas"&&(a[l]==undefined||a[l]>=0)){u.domElements[l].getContext("2d").clearRect(0,0,u.domElements[l].width,u.domElements[l].height)}}u.plotter.currentEdgeIndex=0;u.plotter.currentNodeIndex=0;u.plotter.currentLabelIndex=0;var c=null;var h=false;if(i){if(i>1){while(u.plotter.task_drawNode()){}}else{sigma.chronos.addTask(u.plotter.task_drawNode,"node_"+u.id,false);h=true;c="node_"+u.id}}if(o){if(o>1){while(u.plotter.task_drawLabel()){}}else{if(c){sigma.chronos.queueTask(u.plotter.task_drawLabel,"label_"+u.id,c)}else{sigma.chronos.addTask(u.plotter.task_drawLabel,"label_"+u.id,false)}h=true;c="label_"+u.id}}if(s){if(s>1){while(u.plotter.task_drawEdge()){}}else{if(c){sigma.chronos.queueTask(u.plotter.task_drawEdge,"edge_"+u.id,c)}else{sigma.chronos.addTask(u.plotter.task_drawEdge,"edge_"+u.id,false)}h=true;c="edge_"+u.id}}u.dispatch("draw");u.refresh();h&&sigma.chronos.runTasks();return u}function h(){u.domElements.hover.getContext("2d").clearRect(0,0,u.domElements.hover.width,u.domElements.hover.height);p();d();return u}function p(){if(u.p.drawHoverNodes){u.graph.checkHover(u.mousecaptor.mouseX,u.mousecaptor.mouseY);u.graph.nodes.forEach(function(e){if(e.hover&&!e.active){u.plotter.drawHoverNode(e)}})}return u}function d(){if(u.p.drawActiveNodes){u.graph.nodes.forEach(function(e){if(e.active){u.plotter.drawActiveNode(e)}})}return u}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var u=this;this.id=t.toString();this.p={auto:true,drawNodes:2,drawEdges:1,drawLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,drawHoverNodes:true,drawActiveNodes:true};this.domRoot=e;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new r;this.domElements={};l("edges","canvas");l("nodes","canvas");l("labels","canvas");l("hover","canvas");l("monitor","div");l("mouse","canvas");this.plotter=new o(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.hover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new i(this,this.domElements.monitor);this.mousecaptor=new s(this.domElements.mouse,this.id);this.mousecaptor.bind("drag interpolate",function(e){u.draw(u.p.auto?2:u.p.drawNodes,u.p.auto?0:u.p.drawEdges,u.p.auto?2:u.p.drawLabels,true)}).bind("stopdrag stopinterpolate",function(e){u.draw(u.p.auto?2:u.p.drawNodes,u.p.auto?1:u.p.drawEdges,u.p.auto?2:u.p.drawLabels,true)}).bind("mousedown mouseup",function(e){var t=u.graph.nodes.filter(function(e){return!!e["hover"]}).map(function(e){return e.id});u.dispatch(e["type"]=="mousedown"?"downgraph":"upgraph");if(t.length){u.dispatch(e["type"]=="mousedown"?"downnodes":"upnodes",t)}}).bind("move",function(){u.domElements.hover.getContext("2d").clearRect(0,0,u.domElements.hover.width,u.domElements.hover.height);p();d()});sigma.chronos.bind("startgenerators",function(){if(sigma.chronos.getGeneratorsIDs().some(function(e){return!!e.match(new RegExp("_ext_"+u.id+"$",""))})){u.draw(u.p.auto?2:u.p.drawNodes,u.p.auto?0:u.p.drawEdges,u.p.auto?2:u.p.drawLabels)}}).bind("stopgenerators",function(){u.draw()});for(var v=0;v<n.plugins.length;v++){n.plugins[v](this)}this.draw=c;this.resize=a;this.refresh=h;this.drawHover=p;this.drawActive=d;this.clearSchedule=f;window.addEventListener("resize",function(){u.resize()})}function a(e){var t=e;var n=this;sigma.classes.EventDispatcher.call(this);this._core=e;this.kill=function(){};this.getID=function(){return t.id};this.configProperties=function(e,r){var i=t.config(e,r);return i==t?n:i};this.drawingProperties=function(e,r){var i=t.plotter.config(e,r);return i==t.plotter?n:i};this.mouseProperties=function(e,r){var i=t.mousecaptor.config(e,r);return i==t.mousecaptor?n:i};this.graphProperties=function(e,r){var i=t.graph.config(e,r);return i==t.graph?n:i};this.getMouse=function(){return{mouseX:t.mousecaptor.mouseX,mouseY:t.mousecaptor.mouseY,down:t.mousecaptor.isMouseDown}};this.position=function(e,r,i){if(arguments.length==0){return{stageX:t.mousecaptor.stageX,stageY:t.mousecaptor.stageY,ratio:t.mousecaptor.ratio}}else{t.mousecaptor.stageX=e!=undefined?e:t.mousecaptor.stageX;t.mousecaptor.stageY=r!=undefined?r:t.mousecaptor.stageY;t.mousecaptor.ratio=i!=undefined?i:t.mousecaptor.ratio;return n}};this.goTo=function(e,r,i){t.mousecaptor.interpolate(e,r,i);return n};this.zoomTo=function(e,r,i){i=Math.min(Math.max(t.mousecaptor.config("minRatio"),i),t.mousecaptor.config("maxRatio"));if(i==t.mousecaptor.ratio){t.mousecaptor.interpolate(e-t.width/2+t.mousecaptor.stageX,r-t.height/2+t.mousecaptor.stageY)}else{t.mousecaptor.interpolate((i*e-t.mousecaptor.ratio*t.width/2)/(i-t.mousecaptor.ratio),(i*r-t.mousecaptor.ratio*t.height/2)/(i-t.mousecaptor.ratio),i)}return n};this.resize=function(e,r){t.resize(e,r);return n};this.draw=function(e,r,i,s){t.draw(e,r,i,s);return n};this.refresh=function(){t.refresh();return n};this.addGenerator=function(e,r,i){sigma.chronos.addGenerator(e+"_ext_"+t.id,r,i);return n};this.removeGenerator=function(e){sigma.chronos.removeGenerator(e+"_ext_"+t.id);return n};this.addNode=function(e,r){t.graph.addNode(e,r);return n};this.addEdge=function(e,r,i,s){t.graph.addEdge(e,r,i,s);return n};this.dropNode=function(e){t.graph.dropNode(e);return n};this.dropEdge=function(e){t.graph.dropEdge(e);return n};this.pushGraph=function(e,r){e.nodes&&e.nodes.forEach(function(e){e["id"]&&(!r||!t.graph.nodesIndex[e["id"]])&&n.addNode(e["id"],e)});var i;e.edges&&e.edges.forEach(function(e){validID=e["source"]&&e["target"]&&e["id"];validID&&(!r||!t.graph.edgesIndex[e["id"]])&&n.addEdge(e["id"],e["source"],e["target"],e)});return n};this.emptyGraph=function(){t.graph.empty();return n};this.getNodesCount=function(){return t.graph.nodes.length};this.getEdgesCount=function(){return t.graph.edges.length};this.iterNodes=function(e,r){t.graph.iterNodes(e,r);return n};this.iterEdges=function(e,r){t.graph.iterEdges(e,r);return n};this.getNodes=function(e){return t.graph.getNodes(e)};this.getEdges=function(e){return t.graph.getEdges(e)};this.activateMonitoring=function(){return t.monitor.activate()};this.desactivateMonitoring=function(){return t.monitor.desactivate()};t.bind("downnodes upnodes downgraph upgraph",function(e){n.dispatch(e.type,e.content)});t.graph.bind("overnodes outnodes",function(e){n.dispatch(e.type,e.content)})}var t=0;var n={};n.plugins=[];sigma.init=function(e){var n=new u(e,(++t).toString());sigma.instances[t]=new a(n);return sigma.instances[t]};sigma.addPlugin=function(e,t,r){a.prototype[e]=t;n.plugins.push(r)};sigma.chronos=new function(){function v(t){window.setTimeout(t,0);return e}function m(){e.dispatch("frameinserted");while(t&&h.length&&g()){}if(!t||!h.length){b()}else{f=(new Date).getTime();i++;l=u-s;o=s-l;e.dispatch("insertframe");v(m)}}function g(){d=d%h.length;if(!h[d].task()){var t=h[d].taskName;p=p.filter(function(e){e.taskParent==t&&h.push({taskName:e.taskName,task:e.task});return e.taskParent!=t});e.dispatch("killed",h.splice(d--,1)[0])}d++;u=(new Date).getTime()-f;return u<=o}function y(){t=true;d=0;i=0;f=(new Date).getTime();a=f;e.dispatch("start");e.dispatch("insertframe");v(m);return e}function b(){e.dispatch("stop");t=false;return e}function w(n,r,i){if(typeof n!="function"){throw new Error('Task "'+r+'" is not a function')}h.push({taskName:r,task:n});t=!!(t||i&&y()||true);return e}function E(t,n,r){if(typeof t!="function"){throw new Error('Task "'+n+'" is not a function')}if(!h.concat(p).some(function(e){return e.taskName==r})){throw new Error('Parent task "'+r+'" of "'+n+'" is not attached.')}p.push({taskParent:r,taskName:n,task:t});return e}function S(n,r){if(n==undefined){h=[];if(r==1){p=[]}else if(r==2){h=p;p=[]}b()}else{var i=typeof n=="string"?n:"";h=h.filter(function(e){if(typeof n=="string"?e.taskName==n:e.task==n){i=e.taskName;return false}return true});if(r>0){p=p.filter(function(e){if(r==1&&e.taskParent==i){h.push(e)}return e.taskParent!=i})}}t=!!(!h.length||b()&&false);return e}function x(t,n,r){if(c[t]!=undefined){return e}c[t]={task:n,condition:r};N(true)==0&&k();return e}function T(t){if(c[t]){c[t].on=false;c[t].del=true}return e}function N(e){return e?Object.keys(c).filter(function(e){return!!c[e].on}).length:Object.keys(c).length}function C(){return Object.keys(c)}function k(){if(!Object.keys(c).length){e.dispatch("stopgenerators")}else{e.dispatch("startgenerators");e.unbind("killed",L);v(function(){for(var e in c){c[e].on=true;w(c[e].task,e,false)}});e.bind("killed",L).runTasks()}return e}function L(e){if(c[e["content"].taskName]!=undefined){if(c[e["content"].taskName].del||!c[e["content"].taskName].condition()){delete c[e["content"].taskName]}else{c[e["content"].taskName].on=false}if(N(true)==0){k()}}}function A(t){if(t!=undefined){n=Math.abs(1*t);s=1e3/n;i=0;return e}else{return n}}function O(){if(t){r=Math.round(i/((new Date).getTime()-a)*1e4)/10}return r}function M(){return h.length}function _(){return p.length}function D(){return f-a}sigma.classes.EventDispatcher.call(this);var e=this;var t=false;var n=80;var r=0;var i=0;var s=1e3/n;var o=s;var u=0;var a=0;var f=0;var l=0;var c={};var h=[];var p=[];var d=0;this.frequency=A;this.runTasks=y;this.stopTasks=b;this.insertFrame=v;this.addTask=w;this.queueTask=E;this.removeTask=S;this.addGenerator=x;this.removeGenerator=T;this.startGenerators=k;this.getGeneratorsIDs=C;this.getFPS=O;this.getTasksCount=M;this.getQueuedTasksCount=_;this.getExecutionTime=D;return this};sigma.debugMode=0;sigma.log=function(){if(sigma.debugMode==1){for(var e in arguments){console.log(arguments[e])}}else if(sigma.debugMode>1){for(var e in arguments){throw new Error(arguments[e])}}return sigma};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(e){return e};sigma.easing.quadratic.easein=function(e){return e*e};sigma.easing.quadratic.easeout=function(e){return-e*(e-2)};sigma.easing.quadratic.easeinout=function(e){if((e*=2)<1)return.5*e*e;return-.5*(--e*(e-2)-1)};sigma.tools.drawRoundRect=function(e,t,n,r,i,s,o){var u=s?s:0;var a=o?o:[];a=typeof a=="string"?a.split(" "):a;var f=u&&(a.indexOf("topleft")>=0||a.indexOf("top")>=0||a.indexOf("left")>=0);var l=u&&(a.indexOf("topright")>=0||a.indexOf("top")>=0||a.indexOf("right")>=0);var c=u&&(a.indexOf("bottomleft")>=0||a.indexOf("bottom")>=0||a.indexOf("left")>=0);var h=u&&(a.indexOf("bottomright")>=0||a.indexOf("bottom")>=0||a.indexOf("right")>=0);e.moveTo(t,n+u);if(f){e.arcTo(t,n,t+u,n,u)}else{e.lineTo(t,n)}if(l){e.lineTo(t+r-u,n);e.arcTo(t+r,n,t+r,n+u,u)}else{e.lineTo(t+r,n)}if(h){e.lineTo(t+r,n+i-u);e.arcTo(t+r,n+i,t+r-u,n+i,u)}else{e.lineTo(t+r,n+i)}if(c){e.lineTo(t+u,n+i);e.arcTo(t,n+i,t,n+i-u,u)}else{e.lineTo(t,n+i)}e.lineTo(t,n+u)};sigma.tools.drawArrowhead=function(e,t,n,r,i){var s=22;e.beginPath();e.moveTo(t,n);var o=t+Math.cos(.017453292519943295*(s+i))*r;var u=n+Math.sin(.017453292519943295*(s+i))*r;var a=t+Math.cos(.017453292519943295*(i-s))*r;var f=n+Math.sin(.017453292519943295*(i-s))*r;e.lineTo(o,u);e.quadraticCurveTo((t+o+a)/3,(n+u+f)/3,a,f);e.lineTo(t,n);e.fill()};sigma.tools.getRGB=function(e,t){e=e.toString();var n={r:0,g:0,b:0};if(e.length>=3){if(e.charAt(0)=="#"){var r=e.length-1;if(r==6){n={r:parseInt(e.charAt(1)+e.charAt(2),16),g:parseInt(e.charAt(3)+e.charAt(4),16),b:parseInt(e.charAt(5)+e.charAt(5),16)}}else if(r==3){n={r:parseInt(e.charAt(1)+e.charAt(1),16),g:parseInt(e.charAt(2)+e.charAt(2),16),b:parseInt(e.charAt(3)+e.charAt(3),16)}}}}if(t){n=[n["r"],n["g"],n["b"]]}return n};sigma.tools.rgbToHex=function(e,t,n){return sigma.tools.toHex(e)+sigma.tools.toHex(t)+sigma.tools.toHex(n)};sigma.tools.toHex=function(e){e=parseInt(e,10);if(isNaN(e)){return"00"}e=Math.max(0,Math.min(e,255));return"0123456789ABCDEF".charAt((e-e%16)/16)+"0123456789ABCDEF".charAt(e%16)};sigma.tools.getIncidenceAngle=function(e,t,n,r){return(e<=n?180:0)+Math.atan((r-t)/(n-e))*180/Math.PI};sigma.publicPrototype=a.prototype})()
